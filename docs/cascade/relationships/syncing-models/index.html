<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-cascade/relationships/syncing-models" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.3.2">
<title data-rh="true">Syncing Models | Warlock.js</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://mentoor.io/logo.svg"><meta data-rh="true" name="twitter:image" content="https://mentoor.io/logo.svg"><meta data-rh="true" property="og:url" content="https://warlock.js.org/docs/cascade/relationships/syncing-models"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Syncing Models | Warlock.js"><meta data-rh="true" name="description" content="Syncing models is a major powerful feature in Cascade, it allows you to embed documents inside other documents, and it will auto update the embedded documents whenever the original document is updated."><meta data-rh="true" property="og:description" content="Syncing models is a major powerful feature in Cascade, it allows you to embed documents inside other documents, and it will auto update the embedded documents whenever the original document is updated."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://warlock.js.org/docs/cascade/relationships/syncing-models"><link data-rh="true" rel="alternate" href="https://warlock.js.org/docs/cascade/relationships/syncing-models" hreflang="en"><link data-rh="true" rel="alternate" href="https://warlock.js.org/docs/cascade/relationships/syncing-models" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.2182b04a.css">
<script src="/assets/js/runtime~main.5c286dca.js" defer="defer"></script>
<script src="/assets/js/main.e6d1dc1a.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="https://mentoor.io/logo.svg" alt="mentoor.io" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="https://mentoor.io/logo.svg" alt="mentoor.io" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Warlock.js EcoSystem</b></a><a class="navbar__item navbar__link" href="/docs/warlock/getting-started/introduction">Warlock</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/cascade/getting-started/introduction">Cascade</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hassanzohdy" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/getting-started-1">Getting Started</a><button aria-label="Expand sidebar category &#x27;Getting Started&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/queries">Queries</a><button aria-label="Expand sidebar category &#x27;Queries&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/models">Models</a><button aria-label="Expand sidebar category &#x27;Models&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/aggregation">Aggregation</a><button aria-label="Expand sidebar category &#x27;Aggregation&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/events">Events</a><button aria-label="Expand sidebar category &#x27;Events&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/indexing">Indexing</a><button aria-label="Expand sidebar category &#x27;Indexing&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/relationships">Relationships</a><button aria-label="Collapse sidebar category &#x27;Relationships&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cascade/relationships/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cascade/relationships/embedded-documents">Embedded Documents</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/cascade/relationships/syncing-models">Syncing Models</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cascade/relationships/joins">Joins (Lookups)</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/advanced-1">Advanced</a><button aria-label="Expand sidebar category &#x27;Advanced&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/relationships"><span itemprop="name">Relationships</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Syncing Models</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1 id="syncing-models">Syncing Models</h1>
<p>Syncing models is a major powerful feature in <code>Cascade</code>, it allows you to embed documents inside other documents, and it will auto update the embedded documents whenever the original document is updated.</p>
<h2 id="the-problem">The Problem</h2>
<p>Let&#x27;s say we have a category model, and post model, the post has an embedded document for category, the problem here is whenever the category is updated, the post keeps the same information about the category when the post is saved.</p>
<h2 id="the-solution">The Solution</h2>
<p>The solution here is with <code>Syncing Models</code>, the concept is simple, when the category is updated, search for all categories that are embedded inside posts, and update them.</p>
<p>We have here two scenarios:</p>
<ol>
<li>Single embedded document</li>
<li>Array of embedded documents</li>
</ol>
<p>Let&#x27;s see each one of them.</p>
<h2 id="single-embedded-document">Single Embedded Document</h2>
<p>Let&#x27;s go with the single embedded document scenario, as we mentioned we need to update the post&#x27;s category when the category itself is updated.</p>
<p>Let&#x27;s take a look at the post model:</p>
<pre><code class="language-ts" metastring="title=&quot;src/models/post.ts&quot;">import { Model, Casts, castModel } from &quot;@warlock.js/cascade&quot;;
import { Category } from &quot;./category&quot;;

export class Post extends Model {
  /**
   * Collection name
   */
  public static collection = &quot;posts&quot;;

  /**
   * {@inheritDoc}
   */
  protected casts: Casts = {
    title: &quot;string&quot;,
    content: &quot;string&quot;,
    category: castModel(Category),
  };
}
</code></pre>
<p>Let&#x27;s take a look at the category model:</p>
<pre><code class="language-ts" metastring="title=&quot;src/models/category.ts&quot;">import { Model, Casts } from &quot;@warlock.js/cascade&quot;;

export class Category extends Model {
  /**
   * Collection name
   */
  public static collection = &quot;categories&quot;;

  /**
   * {@inheritDoc}
   */
  protected casts: Casts = {
    name: &quot;string&quot;,
    isActive: &quot;boolean&quot;,
  };
}
</code></pre>
<p>This is just a normal category model, let&#x27;s update the code to make it synced with the post model:</p>
<pre><code class="language-ts" metastring="title=&quot;src/models/category.ts&quot; {1,14}">import { Model, Casts, ModelSync } from &quot;@warlock.js/cascade&quot;;

export class Category extends Model {
  /**
   * Collection name
   */
  public static collection = &quot;categories&quot;;

  /**
   * Sync with posts
   */
  public syncWith: ModelSync[] = [
    // sync post
    Post.sync(&quot;category&quot;),
  ];

  /**
   * {@inheritDoc}
   */
  protected casts: Casts = {
    name: &quot;string&quot;,
    isActive: &quot;boolean&quot;,
  };
}
</code></pre>
<p>Let&#x27;s understand what&#x27;s happening here:</p>
<p>First off, We added a new property called <code>syncWith</code> that is an array of <code>ModelSync</code> instances.</p>
<p>We can create an instance of <code>ModelSync</code> that is linked to the model using the static method <code>sync</code>, this method returns a new instance of <code>ModelSync</code> that is linked to the model.</p>
<p>The <code>sync</code> method takes first argument with the name of the field that we need to update in our case it will be the <code>category</code> field in the post model.</p>
<p>So the scenario here as follows, category data is updated, the <code>ModelSync</code> class will be instantly called after the model is saved, it will search in the <code>posts</code> collection for all posts that has the same category id, which internally searches in <code>category.id</code> field, but we only pass the top field name which is <code>category</code></p>
<h2 id="array-of-embedded-documents">Array of Embedded Documents</h2>
<p>The second scenario is when we have an array of embedded documents, let&#x27;s say we have a post model that has an array of comments, we want to update the comments list inside the post when a comment is updated.</p>
<admonition type="warning"><p>This is just an example, it is <strong>not recommended</strong> to store comments inside each post document, it is better to store them in a separate collection.</p></admonition>
<p>Let&#x27;s take a look at the post model:</p>
<pre><code class="language-ts" metastring="title=&quot;src/models/post.ts&quot;">import { Model, Casts, castModel } from &quot;@warlock.js/cascade&quot;;
import { Comment } from &quot;./comment&quot;;

export class Post extends Model {
  /**
   * Collection name
   */
  public static collection = &quot;posts&quot;;

  /**
   * {@inheritDoc}
   */
  protected casts: Casts = {
    title: &quot;string&quot;,
    content: &quot;string&quot;,
    comments: castModel(Comment),
  };
}
</code></pre>
<p>Let&#x27;s take a look at the comment model:</p>
<pre><code class="language-ts" metastring="title=&quot;src/models/comment.ts&quot;">import { Model, Casts, ModelSync } from &quot;@warlock.js/cascade&quot;;
import { Post } from &quot;./post&quot;;

export class Comment extends Model {
  /**
   * Collection name
   */
  public static collection = &quot;comments&quot;;

  /**
   * Sync with posts
   */
  public syncWith: ModelSync[] = [
    // sync comments inside post whenever a comment is updated
    Post.syncMany(&quot;comments&quot;),
  ];

  /**
   * {@inheritDoc}
   */
  protected casts: Casts = {
    content: &quot;string&quot;,
    isActive: &quot;boolean&quot;,
  };
}
</code></pre>
<p>The <code>syncMany</code> method works exactly like <code>sync</code> except that it will search inside an array of embedded documents.</p>
<admonition type="info"><p>The rest of the coming documentation works in both scenarios <code>sync</code> and <code>syncMany</code> but we will use <code>sync</code> for simplicity</p></admonition>
<h2 id="embedded-custom-data">Embedded custom data</h2>
<p>By default the <code>ModelSync</code> will call the <code>embeddedData</code> property to get the data from, but if we want to use another property we can pass it as a second argument to the <code>sync</code> method.</p>
<p>Let&#x27;s say we want to sync the category id and name only, we can do it like this:</p>
<pre><code class="language-ts" metastring="title=&quot;src/models/category.ts&quot; {1,14}">import { Model, Casts, ModelSync } from &quot;@warlock.js/cascade&quot;;

export class Category extends Model {
  /**
   * Collection name
   */
  public static collection = &quot;categories&quot;;

  /**
   * Sync with posts
   */
  public syncWith: ModelSync[] = [
    // sync post
    Post.sync(&quot;category&quot;, &quot;embedIdAndNameOnly&quot;),
  ];

  /**
   * {@inheritDoc}
   */
  protected casts: Casts = {
    name: &quot;string&quot;,
    isActive: &quot;boolean&quot;,
  };

  /**
   * Embed id and name only
   */
  public get embedIdAndNameOnly() {
    return this.only([&quot;id&quot;, &quot;name&quot;]);
  }
}
</code></pre>
<h2 id="update-multiple-fields">Update multiple fields</h2>
<p>Another scenario where we want to update multiple columns when the model is updated, let&#x27;s say we want to update <code>createdBy</code> and <code>updatedBy</code> fields in the post when the user is updated, in that case, pass an array of fields to the <code>sync</code> method:</p>
<pre><code class="language-ts" metastring="title=&quot;src/models/user.ts&quot; {1,14}">import { Model, Casts, ModelSync } from &quot;@warlock.js/cascade&quot;;

export class User extends Model {
  /**
   * Collection name
   */
  public static collection = &quot;users&quot;;

  /**
   * Sync with posts
   */
  public syncWith: ModelSync[] = [
    // sync post
    Post.sync([&quot;createdBy&quot;, &quot;updatedBy&quot;]),
  ];

  /**
   * {@inheritDoc}
   */
  protected casts: Casts = {
    name: &quot;string&quot;,
    isActive: &quot;boolean&quot;,
  };
}
</code></pre>
<p>What happens here the <code>ModelSync</code> will search in all columns that has the same value as the user id, which internally searches in <code>createdBy.id</code> and <code>updatedBy.id</code> fields, but we only pass the top field name which is <code>createdBy</code> and <code>updatedBy</code></p>
<h2 id="unset-on-delete">Unset On Delete</h2>
<p>Another scenario is being taking care of is when the actual document of the embedded document is deleted, in that case we can perform multiple actions based on our needs.</p>
<ol>
<li>Unset the embedded document.</li>
<li>Delete the document that has the embedded document.</li>
<li>Do nothing.</li>
</ol>
<p>Let&#x27;s see each one of them:</p>
<h3 id="unset-the-embedded-document">Unset the embedded document</h3>
<p>Call <code>unsetOnDelete</code> method on the <code>ModelSync</code> instance, this will unset the embedded document when the actual document is deleted.</p>
<pre><code class="language-ts" metastring="title=&quot;src/models/category.ts&quot; {1,14}">import { Model, Casts, ModelSync } from &quot;@warlock.js/cascade&quot;;
import { Post } from &quot;./post&quot;;

export class Category extends Model {
  /**
   * Collection name
   */
  public static collection = &quot;categories&quot;;

  /**
   * Sync with posts
   */
  public syncWith: ModelSync[] = [
    // sync post
    Post.sync(&quot;category&quot;).unsetOnDelete(),
  ];

  /**
   * {@inheritDoc}
   */
  protected casts: Casts = {
    name: &quot;string&quot;,
    isActive: &quot;boolean&quot;,
  };
}
</code></pre>
<blockquote>
<p>This is the default behavior, so you don&#x27;t have to call <code>unsetOnDelete</code> method.</p>
</blockquote>
<h3 id="delete-the-document-that-has-the-embedded-document">Delete the document that has the embedded document</h3>
<p>The second scenario we can think of, when the original document is deleted, delete all related documents, for example we can delete all posts when their category is deleted.</p>
<pre><code class="language-ts" metastring="title=&quot;src/models/category.ts&quot; {1,14}">import { Model, Casts, ModelSync } from &quot;@warlock.js/cascade&quot;;
import { Post } from &quot;./post&quot;;

export class Category extends Model {
  /**
   * Collection name
   */
  public static collection = &quot;categories&quot;;

  /**
   * Sync with posts
   */
  public syncWith: ModelSync[] = [
    // sync post
    Post.sync(&quot;category&quot;).removeOnDelete(),
  ];

  /**
   * {@inheritDoc}
   */
  protected casts: Casts = {
    name: &quot;string&quot;,
    isActive: &quot;boolean&quot;,
  };
}
</code></pre>
<p>By calling <code>removeOnDelete</code>, the <code>ModelSync</code> will search for all posts that have the deleted category and remove them.</p>
<h3 id="ignoring-the-delete-action">Ignoring the delete action</h3>
<p>The third scenario is when we want to ignore the delete action, in that case we can call <code>ignoreOnDelete</code> method.</p>
<pre><code class="language-ts" metastring="title=&quot;src/models/category.ts&quot; {1,14}">import { Model, Casts, ModelSync } from &quot;@warlock.js/cascade&quot;;
import { Post } from &quot;./post&quot;;

export class Category extends Model {
  /**
   * Collection name
   */
  public static collection = &quot;categories&quot;;

  /**
   * Sync with posts
   */
  public syncWith: ModelSync[] = [
    // sync post
    Post.sync(&quot;category&quot;).ignoreOnDelete(),
  ];

  /**
   * {@inheritDoc}
   */
  protected casts: Casts = {
    name: &quot;string&quot;,
    isActive: &quot;boolean&quot;,
  };
}
</code></pre>
<p>This will keep the <code>category</code> document inside the post when the category is deleted.</p>
<h2 id="sync-only-when-certain-fields-are-updated">Sync only when certain fields are updated</h2>
<p>Because this is a costy operation, we can limit the sync to only when certain fields are updated, for example we can sync the category when the <code>name</code> is updated, any other updated fields will not trigger the sync, in that case use <code>updateWhenChange</code> by passing the fields that we want to sync when they are updated.</p>
<pre><code class="language-ts" metastring="title=&quot;src/models/category.ts&quot; {1,14}">import { Model, Casts, ModelSync } from &quot;@warlock.js/cascade&quot;;
import { Post } from &quot;./post&quot;;

export class Category extends Model {
  /**
   * Collection name
   */
  public static collection = &quot;categories&quot;;

  /**
   * Sync with posts
   */
  public syncWith: ModelSync[] = [
    // sync post
    Post.sync(&quot;category&quot;).updateWhenChange([&quot;name&quot;]),
  ];

  /**
   * {@inheritDoc}
   */
  protected casts: Casts = {
    name: &quot;string&quot;,
    isActive: &quot;boolean&quot;,
  };
}
</code></pre>
<h2 id="update-with-certain-criteria">Update with certain criteria</h2>
<p>Sometimes it is not good to update all documents that has the same id, for example we can update the category in the post only when the post is active, in that case we can use the <code>where</code> method that returns a query builder instance.</p>
<pre><code class="language-ts" metastring="title=&quot;src/models/category.ts&quot; {1,14}">import { Model, Casts, ModelSync } from &quot;@warlock.js/cascade&quot;;
import { Post } from &quot;./post&quot;;

export class Category extends Model {
  /**
   * Collection name
   */
  public static collection = &quot;categories&quot;;

  /**
   * Sync with posts
   */
  public syncWith: ModelSync[] = [
    // sync post
    Post.sync(&quot;category&quot;).where(query =&gt; {
      query.where(&quot;isActive&quot;, true);
    }),
    }),
  ];

  /**
   * {@inheritDoc}
   */
  protected casts: Casts = {
    name: &quot;string&quot;,
    isActive: &quot;boolean&quot;,
  };
}
</code></pre>
<p>The <code>query</code> here is an instance of the <a href="/docs/cascade/aggregate/model-aggregate">Model Aggregate Query</a> so you can easily apply whatever filter you would like when fetching posts.</p>
<h2 id="a-final-note-about-sync">A final Note about Sync</h2>
<p>All sync operations first fetch the documents then perform a <code>save</code> or <code>destroy</code> actions, this will allow multiple sync operations to be performed in one query.</p>
<p>For example, if category is updated, find all posts for that category, and update each one of them, this will call all <code>syncs</code> inside the post, in that sense, all comments will be updated as well if they are synced with the posts.</p>
<p>Also, all related events like <code>onSaving</code>, <code>onSaved</code>, <code>onDeleting</code>, <code>onDeleted</code>...etc will be triggered as well.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/cascade/relationships/embedded-documents"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Embedded Documents</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/cascade/relationships/joins"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Joins (Lookups)</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-problem" class="table-of-contents__link toc-highlight">The Problem</a></li><li><a href="#the-solution" class="table-of-contents__link toc-highlight">The Solution</a></li><li><a href="#single-embedded-document" class="table-of-contents__link toc-highlight">Single Embedded Document</a></li><li><a href="#array-of-embedded-documents" class="table-of-contents__link toc-highlight">Array of Embedded Documents</a></li><li><a href="#embedded-custom-data" class="table-of-contents__link toc-highlight">Embedded custom data</a></li><li><a href="#update-multiple-fields" class="table-of-contents__link toc-highlight">Update multiple fields</a></li><li><a href="#unset-on-delete" class="table-of-contents__link toc-highlight">Unset On Delete</a><ul><li><a href="#unset-the-embedded-document" class="table-of-contents__link toc-highlight">Unset the embedded document</a></li><li><a href="#delete-the-document-that-has-the-embedded-document" class="table-of-contents__link toc-highlight">Delete the document that has the embedded document</a></li><li><a href="#ignoring-the-delete-action" class="table-of-contents__link toc-highlight">Ignoring the delete action</a></li></ul></li><li><a href="#sync-only-when-certain-fields-are-updated" class="table-of-contents__link toc-highlight">Sync only when certain fields are updated</a></li><li><a href="#update-with-certain-criteria" class="table-of-contents__link toc-highlight">Update with certain criteria</a></li><li><a href="#a-final-note-about-sync" class="table-of-contents__link toc-highlight">A final Note about Sync</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2024 mentoor.io, Inc.</div></div></div></footer></div>
</body>
</html>