"use strict";(self.webpackChunkmongez_docs=self.webpackChunkmongez_docs||[]).push([[6092],{1642:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>c});var t=n(4848),o=n(5680);const a={sidebar_position:33},i="Create Your Own Rule",s={id:"warlock/validation/rules/create-your-own-rule",title:"Create Your Own Rule",description:"To create a new rule, you need to create a class that extends the Rule class.",source:"@site/docs/warlock/validation/rules/create-your-own-rule.mdx",sourceDirName:"warlock/validation/rules",slug:"/warlock/validation/rules/create-your-own-rule",permalink:"/docs/warlock/validation/rules/create-your-own-rule",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:33,frontMatter:{sidebar_position:33},sidebar:"warlock",previous:{title:"Url",permalink:"/docs/warlock/validation/rules/url"},next:{title:"Validation errors",permalink:"/docs/warlock/validation/validation-errors"}},l={},c=[{value:"Error method",id:"error-method",level:2},{value:"Usage",id:"usage",level:2},{value:"Error placeholder",id:"error-placeholder",level:2}];function d(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,o.RP)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.h1,{id:"create-your-own-rule",children:"Create Your Own Rule"}),"\n",(0,t.jsxs)(r.p,{children:["To create a new rule, you need to create a class that extends the ",(0,t.jsx)(r.code,{children:"Rule"})," class."]}),"\n",(0,t.jsxs)(r.p,{children:["Let's create a rule that validates phone number to start with ",(0,t.jsx)(r.code,{children:"+2"})," as optional then ",(0,t.jsx)(r.code,{children:"01"})," then ",(0,t.jsx)(r.code,{children:"0|1|2|5"})," then 8 digits."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",metastring:'title="src/app/general/validation/phone.ts"',children:'import { Rule } from "@warlock.js/core";\r\n\r\nexport class PhoneNumberRule extends Rule {\r\n  /**\r\n   * Rule name\r\n   */\r\n  public static ruleName = "phoneNumber";\r\n\r\n  /**\r\n   * Validate the rule\r\n   */\r\n  public async validate() {\r\n    const phoneNumber = this.value; // the input value\r\n    const regex = /^(?:\\+2)?01[0125]\\d{8}$/;\r\n\r\n    this.isValid = regex.test(phoneNumber);\r\n  }\r\n\r\n  /**\r\n   * Get error message\r\n   */\r\n  public error() {\r\n    return this.trans("phoneNumber");\r\n  }\r\n}\n'})}),"\n",(0,t.jsx)(r.p,{children:"Let's explain the code above:"}),"\n",(0,t.jsxs)(r.p,{children:["First, we defined the ",(0,t.jsx)(r.code,{children:"ruleName"}),", it's mandatory to be unique to not make any conflicts with other validation rules."]}),"\n",(0,t.jsxs)(r.p,{children:["Then we defined the ",(0,t.jsx)(r.code,{children:"validate"})," method, this is async method that will be called when validating the input."]}),"\n",(0,t.jsxs)(r.p,{children:["The ",(0,t.jsx)(r.code,{children:"value"})," property is the input's value that is taken from the request payload."]}),"\n",(0,t.jsx)(r.p,{children:"Then we wrote down our regular expression to validate the phone number."}),"\n",(0,t.jsxs)(r.p,{children:["Finally, ",(0,t.jsx)(r.code,{children:"isValid"})," property is used to indicate if the input is valid or not."]}),"\n",(0,t.jsx)(r.h2,{id:"error-method",children:"Error method"}),"\n",(0,t.jsxs)(r.p,{children:["The ",(0,t.jsx)(r.code,{children:"error"})," method is used to return the error message if the input is invalid."]}),"\n",(0,t.jsxs)(r.p,{children:["We used ",(0,t.jsx)(r.code,{children:"trans"})," method that is inherited from the ",(0,t.jsx)(r.code,{children:"Rule"})," class, this method is used to translate the error message."]}),"\n",(0,t.jsxs)(r.p,{children:["The ",(0,t.jsx)(r.code,{children:"trans"})," method receives the validation key error that will be used for translation, in our case we'll call it ",(0,t.jsx)(r.code,{children:"phoneNumber"}),", now let's define the validation error message."]}),"\n",(0,t.jsxs)(r.p,{children:["Go to ",(0,t.jsx)(r.code,{children:"src/app/general/utils/locales.ts"})," and add the following:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",metastring:'title="src/app/general/utils/locales.ts"',children:'import { groupedTranslation } from "@mongez/localization":\r\n\r\ngroupedTranslation("validation", {\r\n    phoneNumber: {\r\n        en: "Invalid phone number",\r\n        ar: "\u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062a\u0641 \u063a\u064a\u0631 \u0635\u062d\u064a\u062d",\r\n        // any other locale code\r\n    }\r\n});\n'})}),"\n",(0,t.jsx)(r.p,{children:"Now let's add it to our validation configurations:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",metastring:'title="src/config/validation.ts"',children:'import { PhoneNumberRule } from "app/general/validation/phone";\r\nimport type { ValidationConfigurations } from "@warlock.js/core";\r\n\r\nconst validationConfigurations: ValidationConfigurations = {\r\n  rules: {\r\n    phoneNumber: PhoneNumberRule,\r\n    // rest of rules\r\n  },\r\n  //...\r\n};\n'})}),"\n",(0,t.jsx)(r.h2,{id:"usage",children:"Usage"}),"\n",(0,t.jsxs)(r.p,{children:["To use it, add it to the validation rules in any handler, let's do it in the ",(0,t.jsx)(r.code,{children:"create-account"})," handler:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",metastring:'title="src/app/users/controllers/auth/create-account.ts"',children:'import { Request, Response } from "@warlock.js/core";\r\nimport { User } from "app/users/models/user";\r\n\r\nexport default async function createAccount(\r\n  request: Request,\r\n  response: Response\r\n) {\r\n  // do logic here\r\n}\r\n\r\ncreateAccount.validation = {\r\n  rules: {\r\n    email: ["required", "email"],\r\n    password: ["required", "string"],\r\n    phoneNumber: ["required", "phoneNumber"],\r\n  },\r\n};\n'})}),"\n",(0,t.jsx)(r.h2,{id:"error-placeholder",children:"Error placeholder"}),"\n",(0,t.jsxs)(r.p,{children:["When calling any error, it receives a placeholder object that contains by default ",(0,t.jsx)(r.code,{children:"input"})," key which contains the input name and ",(0,t.jsx)(r.code,{children:"value"})," which holds the current input value."]}),"\n",(0,t.jsxs)(r.p,{children:["Also, we can pass to ",(0,t.jsx)(r.code,{children:"trans"})," method an object to add more placeholders, for example this is the ",(0,t.jsx)(r.code,{children:"error"})," method in the ",(0,t.jsx)(r.a,{href:"./min-length",children:"minLength Rule"})]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:'\r\n\r\n  /**\r\n   * Get error message\r\n   */\r\n  public error() {\r\n    return this.trans("minLength", {\r\n      min: this.options[0],\r\n    });\r\n  }\n'})}),"\n",(0,t.jsx)(r.p,{children:"By defining this we can now use the following placeholder in the translation:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:'groupedTranslation("validation", {\r\n  minLength: {\r\n    en: "The :input must be at least :min characters",\r\n    ar: "\u064a\u062c\u0628 \u0623\u0646 \u064a\u0643\u0648\u0646 :input \u0639\u0644\u0649 \u0627\u0644\u0623\u0642\u0644 :min \u0623\u062d\u0631\u0641",\r\n    // any other locale code\r\n  },\r\n});\n'})})]})}function h(e={}){const{wrapper:r}={...(0,o.RP)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},5680:(e,r,n)=>{n.d(r,{RP:()=>c});var t=n(6540);function o(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function a(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function i(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?a(Object(n),!0).forEach((function(r){o(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function s(e,r){if(null==e)return{};var n,t,o=function(e,r){if(null==e)return{};var n,t,o={},a=Object.keys(e);for(t=0;t<a.length;t++)n=a[t],r.indexOf(n)>=0||(o[n]=e[n]);return o}(e,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(t=0;t<a.length;t++)n=a[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=t.createContext({}),c=function(e){var r=t.useContext(l),n=r;return e&&(n="function"==typeof e?e(r):i(i({},r),e)),n},d={inlineCode:"code",wrapper:function(e){var r=e.children;return t.createElement(t.Fragment,{},r)}},h=t.forwardRef((function(e,r){var n=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,h=s(e,["components","mdxType","originalType","parentName"]),u=c(n),p=o,m=u["".concat(l,".").concat(p)]||u[p]||d[p]||a;return n?t.createElement(m,i(i({ref:r},h),{},{components:n})):t.createElement(m,i({ref:r},h))}));h.displayName="MDXCreateElement"}}]);