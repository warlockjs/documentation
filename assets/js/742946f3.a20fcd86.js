"use strict";(self.webpackChunkmongez_docs=self.webpackChunkmongez_docs||[]).push([[5781],{3905:(e,t,n)=>{n.d(t,{Zo:()=>h,kt:()=>m});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),l=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},h=function(e){var t=l(e.components);return r.createElement(s.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,h=o(e,["components","mdxType","originalType","parentName"]),p=l(n),d=a,m=p["".concat(s,".").concat(d)]||p[d]||u[d]||i;return n?r.createElement(m,c(c({ref:t},h),{},{components:n})):r.createElement(m,c({ref:t},h))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,c=new Array(i);c[0]=d;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[p]="string"==typeof e?e:a,c[1]=o;for(var l=2;l<i;l++)c[l]=n[l];return r.createElement.apply(null,c)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},2866:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>c,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>l});var r=n(7462),a=(n(7294),n(3905));const i={sidebar_position:11},c="Make Your Own Cache Driver",o={unversionedId:"warlock/cache/make-your-own-cache-driver",id:"warlock/cache/make-your-own-cache-driver",title:"Make Your Own Cache Driver",description:"Warlock ships with a few cache drivers out of the box, but you can easily make your own. All you need to do is implement the CacheDriver interface.",source:"@site/docs/warlock/cache/make-your-own-cache-driver.mdx",sourceDirName:"warlock/cache",slug:"/warlock/cache/make-your-own-cache-driver",permalink:"/docs/warlock/cache/make-your-own-cache-driver",draft:!1,tags:[],version:"current",sidebarPosition:11,frontMatter:{sidebar_position:11},sidebar:"warlock",previous:{title:"Null Cache Driver",permalink:"/docs/warlock/cache/null"},next:{title:"Cache Utilities",permalink:"/docs/warlock/cache/utils"}},s={},l=[{value:"Example",id:"example",level:2},{value:"Setting the Options",id:"setting-the-options",level:2},{value:"Connecting to the Cache Driver",id:"connecting-to-the-cache-driver",level:2},{value:"Parsing the Key",id:"parsing-the-key",level:2},{value:"Setting a Value in the Cache",id:"setting-a-value-in-the-cache",level:2}],h={toc:l},p="wrapper";function u(e){let{components:t,...n}=e;return(0,a.kt)(p,(0,r.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"make-your-own-cache-driver"},"Make Your Own Cache Driver"),(0,a.kt)("p",null,"Warlock ships with a few cache drivers out of the box, but you can easily make your own. All you need to do is implement the ",(0,a.kt)("a",{parentName:"p",href:"./cache-driver-interface"},"CacheDriver interface"),"."),(0,a.kt)("h2",{id:"example"},"Example"),(0,a.kt)("p",null,"Let's say we want to implement the ",(0,a.kt)("a",{parentName:"p",href:"https://memcached.org/"},"MemCached")," cache driver. We'll start by creating a new file called ",(0,a.kt)("inlineCode",{parentName:"p"},"memcached-cache-driver.ts")," in your project's ",(0,a.kt)("inlineCode",{parentName:"p"},"src/cache")," directory."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'import { CacheDriver } from "@mongez/warlock";\nimport Memcached from "memcached";\n\n// first off let\'s define the options interface\n\nexport type MemCachedCacheDriverOptions = {\n  host: string;\n  port: number;\n};\n\n// now let\'s define our cache driver class\n\nexport class MemCachedCacheDriver\n  implements CacheDriver<Memcached, MemCachedCacheDriverOptions> {\n  //\n}\n')),(0,a.kt)("p",null,"Now let's see what we have done."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"We have defined the options interface for our cache driver."),(0,a.kt)("li",{parentName:"ul"},"We have defined the cache driver class.")),(0,a.kt)("p",null,"Our driver must implement the ",(0,a.kt)("a",{parentName:"p",href:"./cache-driver-interface"},"CacheDriver interface"),", it takes two type parameters:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The first one is the client type, this is the type of the client that the cache driver will be using."),(0,a.kt)("li",{parentName:"ul"},"The second one is the options type, this is the type of the options that the cache driver will be using.")),(0,a.kt)("h2",{id:"setting-the-options"},"Setting the Options"),(0,a.kt)("p",null,"Now let's define our options property, this property will hold the cache driver options."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"// ...\n\nexport class MemCachedCacheDriver\n  implements CacheDriver<Memcached, MemCachedCacheDriverOptions>\n{\n  /**\n   * The cache driver options\n   */\n  public options: MemCachedCacheDriverOptions = {} as any;\n\n  /**\n   * Set the cache driver options\n   */\n  public setOptions(options: MemCachedCacheDriverOptions) {\n    this.options = options;\n\n    return this;\n  }\n}\n")),(0,a.kt)("p",null,"We defined the ",(0,a.kt)("inlineCode",{parentName:"p"},"options")," property and set its type to ",(0,a.kt)("inlineCode",{parentName:"p"},"MemCachedCacheDriverOptions"),". We also defined the ",(0,a.kt)("inlineCode",{parentName:"p"},"setOptions")," method, this method will be used to set the cache driver options."),(0,a.kt)("h2",{id:"connecting-to-the-cache-driver"},"Connecting to the Cache Driver"),(0,a.kt)("p",null,"To make the driver connection established, we need to define the ",(0,a.kt)("inlineCode",{parentName:"p"},"connect")," method."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"// ...\n\nexport class MemCachedCacheDriver\n  implements CacheDriver<Memcached, MemCachedCacheDriverOptions>\n{\n  // ...\n\n  /**\n   * Connect to the cache driver\n   */\n  public async connect() {\n    this.client = new Memcached(`${this.options.host}:${this.options.port}`);\n\n    return this;\n  }\n}\n")),(0,a.kt)("h2",{id:"parsing-the-key"},"Parsing the Key"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"parseKey")," method is used to parse the key before it is used in the cache. This method is used to make sure that the key is in the correct format."),(0,a.kt)("p",null,"We will use ",(0,a.kt)("a",{parentName:"p",href:"./utils#parse-cache-key"},"Parse Cache Key utility")," to parse the key."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'import { CacheDriver, parseCacheKey } from "@mongez/warlock";\nimport { GenericObject } from "@mongez/reinforcements";\n\n// ...\n\nexport class MemCachedCacheDriver\n  implements CacheDriver<Memcached, MemCachedCacheDriverOptions>\n{\n  // ...\n\n  /**\n   * Parse the key to be used in the cache\n   */\n  public parseKey(key: string | GenericObject) {\n    return parseCacheKey(key);\n  }\n}\n')),(0,a.kt)("p",null,"This function will make sure that the key is in the correct format."),(0,a.kt)("h2",{id:"setting-a-value-in-the-cache"},"Setting a Value in the Cache"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"set")," method is used to set a value in the cache. This method takes two parameters:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The first one is the key that will be used to store the value in the cache."),(0,a.kt)("li",{parentName:"ul"},"The second one is the value that will be stored in the cache.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"// ...\n\nexport class MemCachedCacheDriver\n  implements CacheDriver<Memcached, MemCachedCacheDriverOptions>\n{\n  // ...\n\n  /**\n   * Set a value in the cache\n   */\n  public async set(key: string | GenericObject, value: any) {\n    const parsedKey = this.parseKey(key);\n\n    return new Promise((resolve, reject) => {\n      this.client?.set(parsedKey, value, 0, (error) => {\n        if (error) {\n          return reject(error);\n        }\n\n        resolve();\n      });\n    });\n  }\n}\n")))}u.isMDXComponent=!0}}]);