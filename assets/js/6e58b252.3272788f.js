"use strict";(self.webpackChunkmongez_docs=self.webpackChunkmongez_docs||[]).push([[9031],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>m});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var i=n.createContext({}),g=function(e){var t=n.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},u=function(e){var t=g(e.components);return n.createElement(i.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=g(a),c=r,m=p["".concat(i,".").concat(c)]||p[c]||d[c]||o;return a?n.createElement(m,l(l({ref:t},u),{},{components:a})):n.createElement(m,l({ref:t},u))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,l=new Array(o);l[0]=c;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s[p]="string"==typeof e?e:r,l[1]=s;for(var g=2;g<o;g++)l[g]=a[g];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},8259:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>g});var n=a(7462),r=(a(7294),a(3905));const o={sidebar_position:11},l="Model Aggregate",s={unversionedId:"monpulse/aggregate/model-aggregate",id:"monpulse/aggregate/model-aggregate",title:"Model Aggregate",description:"Combine Models with Aggregate Class.",source:"@site/docs/monpulse/aggregate/model-aggregate.mdx",sourceDirName:"monpulse/aggregate",slug:"/monpulse/aggregate/model-aggregate",permalink:"/docs/monpulse/aggregate/model-aggregate",draft:!1,tags:[],version:"current",sidebarPosition:11,frontMatter:{sidebar_position:11},sidebar:"mongodb",previous:{title:"Data Update",permalink:"/docs/monpulse/aggregate/update"},next:{title:"Events",permalink:"/docs/category/events"}},i={},g=[{value:"Introduction",id:"introduction",level:2},{value:"Model Aggregate Class",id:"model-aggregate-class",level:2},{value:"Example of usage",id:"example-of-usage",level:2},{value:"Return first model",id:"return-first-model",level:2},{value:"Pagination",id:"pagination",level:2},{value:"Chunk",id:"chunk",level:2}],u={toc:g},p="wrapper";function d(e){let{components:t,...a}=e;return(0,r.kt)(p,(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"model-aggregate"},"Model Aggregate"),(0,r.kt)("p",null,"Combine Models with Aggregate Class."),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"We previously saw how ",(0,r.kt)("inlineCode",{parentName:"p"},"Aggregate")," class work, also we had a pretty good look at the ",(0,r.kt)("inlineCode",{parentName:"p"},"Model")," class as well, now let's see how we can combine them together."),(0,r.kt)("h2",{id:"model-aggregate-class"},"Model Aggregate Class"),(0,r.kt)("p",null,"Each model by default has an ",(0,r.kt)("inlineCode",{parentName:"p"},"aggregate")," method which returns an instance of ",(0,r.kt)("inlineCode",{parentName:"p"},"ModelAggregate")," class, this class extends the ",(0,r.kt)("inlineCode",{parentName:"p"},"Aggregate")," class and adds some useful methods to to, also it manipulates it to match the model nature and behavior."),(0,r.kt)("h2",{id:"example-of-usage"},"Example of usage"),(0,r.kt)("p",null,"Let's say we have a ",(0,r.kt)("inlineCode",{parentName:"p"},"User")," model, and we want to get the average age of all users."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="src/models/user.ts"',title:'"src/models/user.ts"'},'import { Model } from "@warlock.js/cascade";\n\nexport class User extends Model {\n  /**\n   * {@inheritDoc}\n   */\n  public static collection = "users";\n}\n')),(0,r.kt)("p",null,"Now let's use the ",(0,r.kt)("inlineCode",{parentName:"p"},"aggregate")," method to get the average age of all users."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="src/index.ts"',title:'"src/index.ts"'},'import { User } from "./models/user";\n\nconst users = await User.aggregate().where("age", ">", 18).get();\n\nconsole.log(users);\n')),(0,r.kt)("p",null,"Unlike the base ",(0,r.kt)("inlineCode",{parentName:"p"},"Aggregate")," class, the ",(0,r.kt)("inlineCode",{parentName:"p"},"ModelAggregate"),"'s ",(0,r.kt)("inlineCode",{parentName:"p"},"get")," method returns an array of models instead of plain objects, so we can use the model methods on the returned documents."),(0,r.kt)("p",null,"If yoy want to override the returned model, pass the first argument with a callback to the ",(0,r.kt)("inlineCode",{parentName:"p"},"get")," method."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'const users = await User.aggregate()\n  .where("age", ">", 18)\n  .get((user) => {\n    return {\n      ...user,\n      fullName: `${user.firstName} ${user.lastName}`,\n    };\n  });\n')),(0,r.kt)("p",null,"This would return an array of objects with the ",(0,r.kt)("inlineCode",{parentName:"p"},"fullName")," property, but not an instance of ",(0,r.kt)("inlineCode",{parentName:"p"},"User")," model."),(0,r.kt)("h2",{id:"return-first-model"},"Return first model"),(0,r.kt)("p",null,"To return the first model, we can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"first")," method."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'const user = await User.aggregate().where("age", ">", 18).first();\n')),(0,r.kt)("h2",{id:"pagination"},"Pagination"),(0,r.kt)("p",null,"Pagination works exactly like normal ",(0,r.kt)("inlineCode",{parentName:"p"},"Aggregate.paginate")," method but the returned documents are instances of the model."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'const { documents: users, paginationInfo } = await User.aggregate()\n  .where("age", ">", 18)\n  .paginate(1, 10);\n')),(0,r.kt)("h2",{id:"chunk"},"Chunk"),(0,r.kt)("p",null,"Chunk method is also available, it works exactly like the ",(0,r.kt)("inlineCode",{parentName:"p"},"Aggregate.chunk")," method but the returned documents are instances of the model."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'await User.aggregate().where("age", ">", 18).chunk(10, (users) => {\n  console.log(users);\n});\n')))}d.isMDXComponent=!0}}]);