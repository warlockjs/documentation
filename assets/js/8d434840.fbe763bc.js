"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7660],{3426:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>a,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>d,toc:()=>l});var n=t(4848),s=t(8453);const o={sidebar_position:5},i="Middleware",d={id:"warlock/http/middleware",title:"Middleware",description:"A middleware is a function that will be executed before the request is handled by the controller.",source:"@site/docs/warlock/http/middleware.mdx",sourceDirName:"warlock/http",slug:"/warlock/http/middleware",permalink:"/docs/warlock/http/middleware",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"warlock",previous:{title:"Uploaded Files",permalink:"/docs/warlock/http/uploaded-files"},next:{title:"Response",permalink:"/docs/warlock/http/response"}},a={},l=[{value:"Middleware In Warlock",id:"middleware-in-warlock",level:2},{value:"How it works",id:"how-it-works",level:2},{value:"Global middleware",id:"global-middleware",level:2},{value:"Adding middleware to all routes except...",id:"adding-middleware-to-all-routes-except",level:2}];function c(e){const r={admonition:"admonition",code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.h1,{id:"middleware",children:"Middleware"}),"\n",(0,n.jsx)(r.p,{children:"A middleware is a function that will be executed before the request is handled by the controller."}),"\n",(0,n.jsx)(r.h2,{id:"middleware-in-warlock",children:"Middleware In Warlock"}),"\n",(0,n.jsx)(r.p,{children:"There are multiple ways to define middleware, by adding it to a route, adding it in a group or define a global middleware."}),"\n",(0,n.jsx)(r.h2,{id:"how-it-works",children:"How it works"}),"\n",(0,n.jsx)(r.p,{children:"Basically, we define a function that accepts the request and response objects, if the function returns a value, the request life cycle is interrupted and the response is sent back to the client thus the controller is never executed."}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-ts",metastring:'title="src/app/users/middleware/validate-user.ts"',children:'import { Request, Response } from "@warlock.js/core";\r\n\r\nexport async function validateUser(request: Request, response: Response) {\r\n  const user = await User.find(request.input("id"));\r\n\r\n  if (!user) {\r\n    return response.notFound();\r\n  }\r\n\r\n  // Add user to the request object\r\n  request.user = user;\r\n}\n'})}),"\n",(0,n.jsx)(r.p,{children:"Now we can use this middleware in our routes:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-ts",metastring:'{5,12} title="src/app/users/routes.ts"',children:'import { router } from "@warlock.js/core";\r\nimport { getUsers } from "./controllers/get-users";\r\nimport { getUser } from "./controllers/get-user";\r\nimport { auth } from "./../middleware/auth";\r\nimport { validateUser } from "./../middleware/validate-user";\r\n\r\nrouter.get("/users", getUsers, {\r\n  middleware: [auth],\r\n});\r\n\r\nrouter.get("/users/:id", getUser, {\r\n  middleware: [auth, validateUser],\r\n});\n'})}),"\n",(0,n.jsxs)(r.p,{children:["So what happens now is when the user requests the ",(0,n.jsx)(r.code,{children:"/users/:id"})," route, the ",(0,n.jsx)(r.code,{children:"validateUser"})," middleware will be executed first, and if the user is not found, the request will be interrupted and the response will be sent back to the client."]}),"\n",(0,n.jsx)(r.p,{children:"And if the user exists, we can now access the user object from the request object:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-ts",metastring:'{2} title="src/app/users/controllers/get-user.ts"',children:'import { Request, Response } from "@warlock.js/core";\r\n\r\nexport async function getUser(request: Request, response: Response) {\r\n  const user = request.user;\r\n\r\n  response.success({\r\n    user,\r\n  });\r\n}\n'})}),"\n",(0,n.jsx)(r.admonition,{type:"tip",children:(0,n.jsx)(r.p,{children:"Middleware are sequence of callbacks that are executed in the order they are defined, so if you have multiple middleware, the first one will be executed first, then the second one, and so on, if any middleware returned a value, the request life cycle will be interrupted and the response will be sent back to the client and all other middleware will be ignored."})}),"\n",(0,n.jsx)(r.h2,{id:"global-middleware",children:"Global middleware"}),"\n",(0,n.jsx)(r.p,{children:"In some situations, we need to execute a middleware for all routes, for example to check if the user is authenticated or not."}),"\n",(0,n.jsxs)(r.p,{children:["To do this, open ",(0,n.jsx)(r.code,{children:"src/config/http.ts"})," file, you'll find there a ",(0,n.jsx)(r.code,{children:"middleware"})," object, add your middleware to the ",(0,n.jsx)(r.code,{children:"all"})," array:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-ts",metastring:'{2,7} title="src/config/http.ts"',children:'import { HttpConfigurations } from "@warlock.js/core";\r\nimport { auth } from "app/users/middleware/auth";\r\n\r\nconst httpConfigurations: HttpConfigurations = {\r\n  // .. other http configurations\r\n  middleware: {\r\n    all: [auth],\r\n  },\r\n};\r\n\r\nexport default httpConfigurations;\n'})}),"\n",(0,n.jsx)(r.p,{children:"Now this middleware will be executed for all routes."}),"\n",(0,n.jsx)(r.h2,{id:"adding-middleware-to-all-routes-except",children:"Adding middleware to all routes except..."}),"\n",(0,n.jsxs)(r.p,{children:["We can add a list of middleware to all routes except some routes, for example we want to add the ",(0,n.jsx)(r.code,{children:"auth"})," middleware to all routes except the login route."]}),"\n",(0,n.jsxs)(r.p,{children:["To do this, use the ",(0,n.jsx)(r.code,{children:"middleware.except"})," object:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-ts",metastring:'{2,7} title="src/config/http.ts"',children:'import { HttpConfigurations } from "@warlock.js/core";\r\nimport { auth } from "app/users/middleware/auth";\r\n\r\nconst httpConfigurations: HttpConfigurations = {\r\n  // .. other http configurations\r\n  middleware: {\r\n    except: {\r\n      routes: ["/login"],\r\n      middleware: [auth],\r\n    },\r\n  },\r\n};\r\n\r\nexport default httpConfigurations;\n'})}),"\n",(0,n.jsxs)(r.p,{children:["This will execute the ",(0,n.jsx)(r.code,{children:"auth"})," middleware for all routes except the ",(0,n.jsx)(r.code,{children:"/login"})," route."]}),"\n",(0,n.jsxs)(r.p,{children:["We can also exclude named routes by using ",(0,n.jsx)(r.code,{children:"namedRoutes"})," instead of ",(0,n.jsx)(r.code,{children:"routes"}),":"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-ts",metastring:'{2,7} title="src/config/http.ts"',children:'import { HttpConfigurations } from "@warlock.js/core";\r\nimport { auth } from "app/users/middleware/auth";\r\n\r\nconst httpConfigurations: HttpConfigurations = {\r\n  // .. other http configurations\r\n  middleware: {\r\n    except: {\r\n      namedRoutes: ["login"],\r\n      middleware: [auth],\r\n    },\r\n  },\r\n};\r\n\r\nexport default httpConfigurations;\n'})})]})}function u(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},8453:(e,r,t)=>{t.d(r,{R:()=>i,x:()=>d});var n=t(6540);const s={},o=n.createContext(s);function i(e){const r=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function d(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),n.createElement(o.Provider,{value:r},e.children)}}}]);